\label{texfile:TemplateMesh}
The next step in the model build workflow is to define a template mesh, which is a 2D finite-element mesh that is used to generate a 3D \gwf\ (and possibly a 2D \swf) finite-element mesh.

Below is an example\footnote{This example was generated using the \tecplot\ layout file \texttt{MUT\_Examples$\backslash$6\_Abdul\_Prism\_Cell$\backslash$FIG Template Abdul.lay}. }
  showing an exploded view of a template mesh ({\sf TMPLT}, bottom image) that was used as a basis for generating  finite-element meshs for the \gwf\ ({\sf TMPLT\_GWF}, middle image) and \swf\ ({\sf TMPLT\_SWF}, upper image) domains:

    \includegraphics[width=0.87\textwidth]{3_7_tmpltAbdul}

Some key features of this example are:
\begin{itemize}
  \item The template mesh is assigned an elevation of zero, and only the $xy$ coordinate data are used to define the other domains.
  \item The \gwf\ domain has been assigned a base elevation of zero, and a variable top elevation.
  \item The \swf\ domain has been assigned the same elevation as the \gwf\ domain i.e.\ they are coincident.
\end{itemize}

\pagebreak
 In this example, the template mesh was defined using these instructions:
 \squish
\begin{verbatim}
    2d mesh from gb
    .\gb\grid
\end{verbatim}
The instruction \textsf{2d mesh from gb}, which requires a single line of input (i.e.: \texttt{.$\backslash$gb$\backslash$grid}), is documented as shown here:

\ins{2d mesh from gb}
    {
        \squish
        \begin{enumerate}
        \item \str{Prefix}  The \gb\footnote{\gb\ is a legacy 2D triangular finite-element grid generator.} dataset prefix, including the path to it.
        \end{enumerate}
        Given \str{Prefix}, this instruction reads the 2D finite-element grid data and uses it to define the 2D template mesh.  \str{Prefix} should contain a relative path to the dataset.  Examples of relative paths are:
        \begin{description}
        \item[.$\backslash$gb$\backslash$grid] The \mut\ input folder contains a local folder \texttt{gb} with the data set prefix \texttt{grid}.
        \item[..$\backslash$gb$\backslash$grid] The parent folder to the \mut\ input folder contains a folder \texttt{gb} with the data set prefix \texttt{grid}.
        \item[C:$\backslash$gb$\backslash$grid] Absolute path to a drive \texttt{C:} folder \texttt{gb} with the data set prefix \texttt{grid}.  Absolute paths are not recommended as they may lead to portability issues.
        \end{description}
        \squish
    }

Most input instructions, including \textsf{2d mesh from gb}, do not include length or time unit information, and \mut\ assumes the current units (i.e.\ either the default units of meters and seconds or other explicitly defined units) apply to the given input data. When supplying input data {\em you must be careful to supply the values in the unit system defined for the model}.  As a reminder, \mut\ will echo the assumed units to the screen and \texttt{o.eco} file, for example:
\begin{verbatim}
    2d mesh from gb
    	Number of nodes:           1372
    	Number of elements:        2651
    	Assumed length Units:  METERS
\end{verbatim}

When databases are used to define material parameter values (see page~\pageref{page:LookupTable}), fields defining the length and time units of each record are included. In this case \mut\ will automatically convert the parameter values to the unit system that has been defined for the \mfus\ model.

\pagebreak
\mut\ now has the capability of generating a 2D-triangular-element mesh from a list of $xy$ coordinates that define the outer boundary of the model domain and a target element size for the mesh triangles.  Below we will discuss an example where regional (outer) and site boundaries are first defined using the \qgis\ software, then saved and imported by \mut\ to generate a template mesh.

The $xy$ coordinates of the outer boundary were obtained from \qgis\ by :
\begin{itemize}
    \item Extracting the vertices (\ref{qgis:ExtractVertices}) from the  {\sf Regional Boundary} layer to obtain a new {\sf vertices} layer.
    \item Adding geometry attributes (\ref{qgis:AddGeometryAttributes}) to the {\sf vertices} layer, creating a new layer {\sf Added geom info}.
    \item Exporting the {\sf Added geom info} layer (\ref{qgis:ExportToCSVFile}) to the {\tt CSV} file: \newline
    {\tt 1\_data$\backslash$5\_ExportToMUT$\backslash$Regional Boundary xy.csv}
\end{itemize}

The file can be opened in \excel\ and modified as shown below:

        \includegraphics[width=\textwidth]{Excel_ModifyRegionalBoundaryCSV.png}

The $xy$ coordinates of the site boundary were obtained from \qgis\ in a similar fashion and saved to the file {\tt 2\_models$\backslash$2DMesh\_Regional$\backslash$ImportSiteBoundary\_xy.csv}.  The site boundary was used to define a region of mesh refinement in the regional model domain.

The $xy$ coordinates of the Shaft observation point were saved to the file {\tt Shaft\_xy.csv}.  This file was used to define a zone of refinement at the location of the Shaft observation point.

The contents of the {\tt 2\_models$\backslash$2DMesh\_Regional} folder prior to mesh generation are shown below:

        \includegraphics[width=\textwidth]{MUT_InitialGridGenFolder.png}

This \mut\ input file {\tt \_build.mut} generates a triangular mesh. The file contents are shown below:

        \includegraphics[width=.8\textwidth]{MUT_2DMeshInput.png}

This instruction starts the grid generation procedure:

\ins{build triangular mesh}
    {This subtask currently requires the following input:
     \begin{itemize}
        \item \str{MeshName} Mesh name, in this case {\sf Regional}
        \item \str{FName} Name of the file containing the $xy$ coordinate list around the outer boundary, in this case {\sf  ImportRegionalBoundary\_xy.csv}
        \item \rnum{TargetLength} [$L$] Target element length, in this case 300 m.
    \end{itemize}

    {\em Optional grid modification instructions may be inserted here...}

    An end instruction is required to stop the subtask e.g.:

    {\Large \sf end build triangular mesh}
}

There are currently 2 {\em Optional grid modification instructions}:

\ins{refine inside polygon}
    {
        \squish
     \begin{itemize}
        \item \str{FName} Name of the file containing the $xy$ coordinate list around the zone of refinement, in this case {\sf  ImportSiteBoundary\_xy.csv}.
    \end{itemize}
    }

\ins{wells from id\_x\_y file}
    {
         \squish
   \begin{itemize}
        \item \str{FName} File name of the file containing the point $xy$ coordinate list.
        \item \rnum{WellTargetLength} [$L$] Target element length near the well, in this case 10 m.
    \end{itemize}
    }

These optional instructions must follow the {\sf TargetLength} input line but can be repeated to define, for example:
\begin{itemize}
\item Different or nested areas of mesh refinement.
\item Multiple wells with different target lengths.
\end{itemize}


To generate uniform 2D rectangular element template meshes\footnote{See for example the verification cases \texttt{1\_VSF\_Column} or \texttt{6\_Abdul\_MODHMS}} use this instruction:

\ins{generate uniform rectangles}
    {\index{generate uniform rectangles}
    \squish
    \begin{enumerate}
    \item \rnum{xLength}[L], \inum{nRectX}  Domain length and number of rectangles in the $x$-direction
    \item \rnum{yLength}[L], \inum{nRectY}  Domain length and number of rectangles in the $y$-direction
    \end{enumerate}
    A 2D finite-element mesh composed of uniform rectangular elements will be generated. In this case, the
    grid is formed by subdividing the domain in the $x$-direction into \inum{nRectX} rectangles, each of length
    \rnum{xLength}/\inum{nRectX}. The domain is subdivided in a similar fashion in the $y$-direction, using the second set of input parameters.
    }

%\includegraphics[width=.15\textwidth]{ModelDevelopment} \textit{Do we have a working quadtree example to add here as an option.}


%This instruction reads a quadtree mesh to define a template mesh \footnote{See for example the verification case \texttt{UNDER CONSTRUCTION}}:
%
%\ins{2d quadtree mesh from groundwater vistas}
%    {\index{2d quadtree mesh from groundwater vistas}
%    \squish
%    \begin{enumerate}
%    \item \textbf{gbprefix}  The \gwv\ \footnote{\gwv\ is  third-party \mf\ development environment software.} dataset prefix, including the path to it.
%    \end{enumerate}
%    Given \textbf{gbprefix}, this instruction reads the 2D finite-element grid data and uses it to define the 2D template mesh.  The prefix should contain a relative path to the dataset.  Examples of relative paths to a Grid Builder prefix variables are:
%
%    \includegraphics[width=.15\textwidth]{UnderConstruction}
%    }

There are two ways that \mf\ cell control volumes can be defined from the template mesh.  By default, \mut\ uses a mesh-centred approach as shown here for a triangular-element template mesh:

    \includegraphics[width=0.6\textwidth]{3_8_MeshCentred}

Some key features to note are:
    \label{page:MeshCentredApproach}
    \phantomsection\label{page:MeshCentredApproach}
\begin{itemize}
    \item Inner circles (dashed circle in yellow triangle), which are tangent to all three element sides, are defined for each triangular element.
    \item The blue-filled circles show the locations of the defined \mf\ cell control volumes.
    \item The vertical connection area of the cell is defined by the triangular element area (yellow-shaded triangle).
    \item The horizontal connection length of the cell is defined by the triangular element side length between neighbouring elements.
\end{itemize}

The mesh-centred approach is similar when using a  rectangular-element template mesh, with the rectangular element area and side lengths defining the vertical connection area and horizontal connection length respectively.

To use a node-centred control volume approach, add this instruction {\em before} defining any \gwf\ or \swf\ model domains:

\ins{nodal control volumes}
    {The node-centered approach will be used to define \mf\ cell centres instead of the default mesh-centered approach.
     }

The result of using a node-centred approach is shown here for a triangular-element template mesh:

    \includegraphics[width=0.6\textwidth]{3_9_NodeCentred}

Some key features to note are:
    \label{page:NodeCentredApproach}
    \phantomsection\label{page:NodeCentredApproach}.
\begin{itemize}
    \item The blue-filled circles show that the locations of the defined \mf\ cell control volumes are now located at template mesh node locations.
    \item The vertical connection area of the cell (yellow-shaded polygon) is defined by the contributing area formed by joining the inner circle centres of each element containing the template mesh node.         \label{page:NodeCentredApproach}
    \item The horizontal connection length of the cell is defined by the distance to a neghbouring node.
\end{itemize}

%\includegraphics[width=.15\textwidth]{UnderConstruction} \textit{Should explain how inner circle radius is used for connection length and perpendicular area for triangles.}



