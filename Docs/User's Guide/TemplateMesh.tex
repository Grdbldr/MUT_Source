\label{texfile:TemplateMesh}
The next step in the model build workflow is to define a template mesh, which is a 2D finite-element mesh that is used to generate a 3D \gwf\ (and possibly a 2D \swf) finite-element mesh.

Below is an example\footnote{This example was generated using the \tecplot\ layout file \texttt{MUT\_Examples$\backslash$6\_Abdul\_Prism\_Cell$\backslash$FIG Template Abdul.lay}. }
  showing an exploded view of a template mesh ({\sf TMPLT}, bottom image) that was used as a basis for generating  finite-element meshs for the \gwf\ ({\sf TMPLT\_GWF}, middle image) and \swf\ ({\sf TMPLT\_SWF}, upper image) domains:

    \includegraphics[width=0.87\textwidth]{3_7_tmpltAbdul}

Some key features of this example are:
\begin{itemize}
  \item The template mesh is assigned an elevation of zero, and only the $xy$ coordinate data are used to define the other domains.
  \item The \gwf\ domain has been assigned a base elevation of zero, and a variable top elevation.
  \item The \swf\ domain has been assigned the same elevation as the \gwf\ domain i.e.\ they are coincident.
\end{itemize}

 In this example, the template mesh was defined using these instructions:
 \squish
\begin{verbatim}
    2d mesh from gb
    .\gb\grid
\end{verbatim}
The instruction \textsf{2d mesh from gb}, which requires a single line of input (i.e.: \texttt{.$\backslash$gb$\backslash$grid}), is documented as shown here:

\ins{2d mesh from gb}
    {
        \squish
        \begin{enumerate}
        \item \str{Prefix}  The \gb\footnote{\gb\ is a legacy 2D triangular finite-element grid generator.} dataset prefix, including the path to it.
        \end{enumerate}
        Given \str{Prefix}, this instruction reads the 2D finite-element grid data and uses it to define the 2D template mesh.  \str{Prefix} should contain a relative path\footnote{Examples of relative paths are: \label{footnote:RelativePath}
        \begin{description}
        \item[.$\backslash$gb$\backslash$grid] The \mut\ input folder contains a local folder \texttt{gb} with the data set prefix \texttt{grid}.
        \item[..$\backslash$gb$\backslash$grid] The parent folder to the \mut\ input folder contains a folder \texttt{gb} with the data set prefix \texttt{grid}.
        \item[C:$\backslash$gb$\backslash$grid] Absolute path to a drive \texttt{C:} folder \texttt{gb} with the data set prefix \texttt{grid}.  Absolute paths are not recommended as they may lead to portability issues.
        \end{description} }
        to the dataset.
    }

Most input instructions, including \textsf{2d mesh from gb}, do not include length or time unit information, and \mut\ assumes the current units (i.e.\ either the default units of meters and seconds or other explicitly defined units) apply to the given input data. When supplying input data {\em you must be careful to supply the values in the unit system defined for the model}.  As a reminder, \mut\ will echo the assumed units to the screen and \texttt{o.eco} file, for example:
\begin{verbatim}
    2d mesh from gb
    	Number of nodes:           1372
    	Number of elements:        2651
    	Assumed length Units:  METERS
\end{verbatim}

When databases are used to define material parameter values (see page~\pageref{page:LookupTable}), fields defining the length and time units of each record are included. In this case \mut\ will automatically convert the parameter values to the unit system that has been defined for the \mfus\ model.

\pagebreak
\mut\ can now generate 2D-triangular-element meshes given a list of $xy$ coordinates that define the outer boundary of the model domain and a target element size for the mesh triangles.  There are also optional instructions for refining portions of the mesh inside a polygon or at a point location. The initial contents of an example\footnote{This example can be found in  folder \texttt{MUT\_Examples$\backslash$\_BuildTriangularMesh$\backslash$\_2DMesh\_Regional}} mesh generation folder are shown below:

        \includegraphics[width=\textwidth]{MESH_RegionalInitialFolderFiles.png}

\qgis\ was used to define the following files:
\begin{description}
    \item [ImportRegionalBoundary\_xy.csv] The regional boundary that forms the outer boundary of the 2D mesh.
    \item [ImportSiteBoundary\_xy.csv]The site boundary that defines a zone of refinement.
    \item [Well.id\_x\_y] The well location that defines a point of refinement.
\end{description}
This \mut\ input file {\tt \_build.mut} generates a triangular mesh. The file contents are shown below:

        \includegraphics[width=\textwidth]{MUT_2DMeshInput.png}

This instruction starts the grid generation procedure:

\ins{build triangular mesh}
    {This subtask currently requires the following input:
     \begin{itemize}
        \item \str{MeshName} Mesh name, in this case {\sf Regional}
        \item \str{FName} Name of the file containing the $xy$ coordinate list around the outer boundary, in this case {\sf  ImportRegionalBoundary\_xy.csv}
        \item \rnum{TargetLength} [$L$] Target element length, in this case 300 m.
    \end{itemize}

    {\em Optional grid modification instructions may be inserted here...}

    An end instruction is required to stop the subtask e.g.:

    {\Large \sf end build triangular mesh}
}

There are currently 2 {\em Optional grid modification instructions}:

\ins{refine inside polygon}
    {
        \squish
     \begin{itemize}
        \item \str{FName} Name of the file containing the $xy$ coordinate list around the zone of refinement, in this case {\sf  ImportSiteBoundary\_xy.csv}.
    \end{itemize}
    }

\ins{wells from id\_x\_y file}
    {
         \squish
   \begin{itemize}
        \item \str{FName} File name of the file containing the point $xy$ coordinate list.
        \item \rnum{WellTargetLength} [$L$] Target element length near the well, in this case 10 m.
    \end{itemize}
    }

These optional instructions must follow the {\sf TargetLength} input line but can be repeated to define, for example:
\begin{itemize}
\item Different or nested areas of mesh refinement.
\item Multiple wells with different target lengths.
\end{itemize}

The contents of the mesh generation folder are shown below after grid generation:

        \includegraphics[width=\textwidth]{MESH_RegionalFinalFolderFiles.png}
Note the following files that have been created:
\begin{description}
    \item [Regional.MeshBIN] This binary file contains the mesh structure and can be read by \mut\ using the instruction {\sf read mesh}, described below.
    \item [Regionalo.nodes.csv] This {\tt csv} file contains node $xyz$ coordinates that can be imported by \qgis\ to, for example, visualize with other map data or to sample DEM elevation data (initially, all $z$ coordinates are set to zero by the grid generator) at node coordinates.
    \item [Regionalo.elements.csv] As above but for triangular-element centroid coordinates.
    \item [Regionalo.tecplot.dat] A \tecplot-formatted output file of the generated mesh. Shown below, the \tecplot\ layout file {\tt \_build.lay} has been loaded into \tecplot\ and the {\sf Data Set Information} dialogue has been opened:

        \includegraphics[width=\textwidth]{MUT_2DMeshInTecplot.png}

        The layout file is configured to load the data file {\tt Regionalo.tecplot.dat} by default.

\end{description}


By default, \mut\ writes {\tt csv} files for \qgis\ but this can be prevented by the following instruction:

        \ins{disable qgis output}
            {\qgis-formatted output files will not be written.}


To generate uniform 2D rectangular element template meshes\footnote{See for example the verification cases \texttt{1\_VSF\_Column} or \texttt{6\_Abdul\_MODHMS}} use this instruction:

\ins{generate uniform rectangles}
    {\index{generate uniform rectangles}
    \squish
    \begin{enumerate}
    \item \rnum{xLength}[L], \inum{nRectX}  Domain length and number of rectangles in the $x$-direction
    \item \rnum{yLength}[L], \inum{nRectY}  Domain length and number of rectangles in the $y$-direction
    \end{enumerate}
    A 2D finite-element mesh composed of uniform rectangular elements will be generated. In this case, the
    grid is formed by subdividing the domain in the $x$-direction into \inum{nRectX} rectangles, each of length
    \rnum{xLength}/\inum{nRectX}. The domain is subdivided in a similar fashion in the $y$-direction, using the second set of input parameters.
    }

To generate variable 2D rectangular element template meshes use this instruction:

\ins{generate variable rectangles}
    {\index{generate variable rectangles}
    \squish
    \begin{enumerate}
    \item \inum{nx}  Desired number of cells \inum{nx} in the $x$-direction +1.
    \item \rnum{xi(i)}, i=1,\inum{nx} Array of \inum{nx} $x$-coordinates.
    \item \inum{ny}  Desired number of cells \inum{ny} in the $y$-direction +1.
    \item \rnum{yi(i)}, i=1,\inum{ny} Array of \inum{ny} $y$-coordinates.
    \end{enumerate}
    A 2D finite-element mesh composed of variably-sized rectangular elements will be generated. In this case, the
    grid is formed by subdividing the domain in the $x$-direction into \inum{nx}-1 rectangles, each of variable length. The domain is subdivided in a similar fashion in the $y$-direction, using the second set of input parameters.
    }

%\includegraphics[width=.15\textwidth]{ModelDevelopment} \textit{Do we have a working quadtree example to add here as an option.}


%This instruction reads a quadtree mesh to define a template mesh \footnote{See for example the verification case \texttt{UNDER CONSTRUCTION}}:
%
%\ins{2d quadtree mesh from groundwater vistas}
%    {\index{2d quadtree mesh from groundwater vistas}
%    \squish
%    \begin{enumerate}
%    \item \textbf{gbprefix}  The \gwv\ \footnote{\gwv\ is  third-party \mf\ development environment software.} dataset prefix, including the path to it.
%    \end{enumerate}
%    Given \textbf{gbprefix}, this instruction reads the 2D finite-element grid data and uses it to define the 2D template mesh.  The prefix should contain a relative path to the dataset.  Examples of relative paths to a Grid Builder prefix variables are:
%
%    \includegraphics[width=.15\textwidth]{UnderConstruction}
%    }

Once a template mesh has been defined by any of the mesh generation options described above, it is automatically saved to a {\tt MeshBIN} file, which can later be loaded into memory using the instruction {\sf read mesh}, which requires the following input:

\ins{read mesh}
    {\squish
    \begin{enumerate}
        \item \str{Prefix}  The {\tt MeshBIN} file prefix, including the path to it (see Footnote~\ref{footnote:RelativePath}).
    \end{enumerate}
    \squish
    }

There are two ways that \mf\ cell control volumes can be defined from the template mesh.  By default, \mut\ uses a mesh-centred approach as shown here for a triangular-element template mesh:

    \includegraphics[width=0.6\textwidth]{3_8_MeshCentred}

Some key features to note are:
    \label{page:MeshCentredApproach}
    \phantomsection\label{page:MeshCentredApproach}
\begin{itemize}
    \item Inner circles (dashed circle in yellow triangle), which are tangent to all three element sides, are defined for each triangular element.
    \item The blue-filled circles show the locations of the defined \mf\ cell control volumes.
    \item The vertical connection area of the cell is defined by the triangular element area (yellow-shaded triangle).
    \item The horizontal connection length of the cell is defined by the triangular element side length between neighbouring elements.
\end{itemize}

The mesh-centred approach is similar when using a  rectangular-element template mesh, with the rectangular element area and side lengths defining the vertical connection area and horizontal connection length respectively.

To use a node-centred control volume approach, add this instruction {\em before} defining any \gwf\ or \swf\ model domains:

\ins{nodal control volumes}
    {The node-centered approach will be used to define \mf\ cell centres instead of the default mesh-centered approach.
     \squish}

The result of using a node-centred approach is shown here for a triangular-element template mesh:

    \includegraphics[width=0.6\textwidth]{3_9_NodeCentred}

Some key features to note are:
    \label{page:NodeCentredApproach}
    \phantomsection\label{page:NodeCentredApproach}.
\begin{itemize}
    \item The blue-filled circles show that the locations of the defined \mf\ cell control volumes are now located at template mesh node locations.
    \item The vertical connection area of the cell (yellow-shaded polygon) is defined by the contributing area formed by joining the inner circle centres of each element containing the template mesh node.         \label{page:NodeCentredApproach}
    \item The horizontal connection length of the cell is defined by the distance to a neghbouring node.
\end{itemize}

%\includegraphics[width=.15\textwidth]{UnderConstruction} \textit{Should explain how inner circle radius is used for connection length and perpendicular area for triangles.}



